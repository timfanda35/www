黑魔法防禦術 IND版
======

TG討論群組：https://t.me/joinchat/A0isxRDS_IZnfSabF-shug   
FB群組：https://www.facebook.com/groups/308549376151517/   
課程講義：https://github.com/sakura26/DADA   
學習目標：看到黑魔法、理解黑魔法、抵抗黑魔法

### 基本技能要求
<https://github.com/sakura26/DADA/blob/master/basic_knowledge.md>

* 網路概論 CCNA
* 封包閱讀能力
* Linux安裝與操作
* Server安裝與管理

```現在不會沒關係，我們會在讀書會中分配任務，一人念一塊組起來就很有效率了ＸＤ```

### 徵求

* 攝影師
* 線上會議設備

### 課程時間

* 一個月一次講課
* 每週四晚上讀書會

讀書會活動：講師分享、學員任務分享、每週任務分配、閒聊打屁

## 活動安排

上學期

* 11/1（期中考前） 資安概論 影片展示 職業技能樹 
* 11/8 讀書會 - CCNA、Linux分組簡報 （蔡老大考OS）
* 11/15 自爆按鈕Workshop 主機防禦基礎、實務、服務防禦概論 
* 11/22 讀書會
* 11/29 讀書會
* 12/6 駭客之路、網路架構基礎、進階、無線網路安全
* 12/13 讀書會
* 12/20 讀書會
* 12/27 讀書會 台科橘子
* 1/3（期末考前） 手把手拆後門 、後門概論

下學期

* 2/21 自我保護 - 如何對抗大規模監控
* 3/7 我要開公司！用 Hacking 的角度把興趣變事業
* 3/14 讀書會
* 3/21 雲端應用：Serverless 初體驗 - 使用Cloud Functions
* 3/28 主機鑑識
* 4/11（期中考前）讀書會
* 4/25 雲端應用：用 Docker CE 玩容器 惡意程式分析
* 5/2 Log分析入門、架構、與戰情分析
* 5/9 讀書會
* 5/16 黑產、APT
* 5/23 讀書會
* 5/30 Hack your life - 駭客的人生指南 、實體安全
* 6/6 Snap打包
* 6/13（期末考前）讀書會


## 11/1 資安概論 影片展示 職業技能樹
### 講義：
* 資訊安全概論，與基礎知識讀書會 https://github.com/sakura26/DADA/blob/master/intro.md
* 基礎知識 https://github.com/sakura26/DADA/blob/master/basic_knowledge.md
* 常見弱點名詞解釋 https://github.com/sakura26/DADA/blob/master/basic_common_vuln.md
* 職涯發展 https://github.com/sakura26/DADA/blob/master/TDOH_skilltree.md

### 黑魔法展示
* NetCut https://www.youtube.com/watch?v=eSIkEBCto40
* cain and abel https://www.youtube.com/watch?v=7TFn6mNk1h8
* GDI+ Exploit  https://www.youtube.com/watch?v=e8loAoxlUl8
* Adobe PDF Exploit 與惡意程式追蹤 https://www.youtube.com/watch?v=cIY0-3DyQvA

### 讀書會讀本
* Linux基礎
http://linux.vbird.org/linux_basic/
* 網路概論與伺服器架設
http://linux.vbird.org/linux_server/
* 去書局買本 CCNA認證考試，跟Linux入門，挑時間念完他

### 任務分配：
* 手作網路線、
* 解釋基礎網路設備：交換器、路由器、防火牆、
* 解釋DNS服務與HTTP服務
* 解釋當你電腦接上網路，連上Google的時候，發生了什麼事（DNS/HTTP互動）
* 解釋ARP Spoofing 
* 解釋磁碟分割 
* 介紹Linux目錄、
* 介紹Linux如何設定IP
* 架設Minecraft伺服器
* 架設一台WebServer讓我們來放錄影

我大力推薦攻殼機動隊這個作品，沒有這部作品，我不會來玩資安
這段影片是駭客攻入一艘國際犯罪組織的航母的片段（劇場版二），不只是炫砲，更是我所認為必然發生的未來
https://youtu.be/wRSYYPhqaKg

http://www.biosmonthly.com/event_topic/8664

## 11/15 自爆按鈕Workshop

https://github.com/sakura26/killallbtn/blob/master/indworkshop.md

材料包團購（11/08 23:59截止）： https://goo.gl/forms/Ivc5wamQgk3wRhO02

## 11/22 守住你的主堡
### 講義
* 主機防禦基礎
https://github.com/sakura26/DADA/blob/master/host_defense_intro.md
* 主機防禦實務
https://github.com/sakura26/DADA/blob/master/host_defense_practice.md 
* 服務防禦基礎
https://github.com/sakura26/DADA/blob/master/service_defense_intro.md

驗證你的主機與服務是否安全

* NMAP https://blog.gtwang.org/linux/nmap-command-examples-tutorials/ 
* Nessus https://www.youtube.com/watch?v=rdENa32eVvY
* Web Security Scanner Acunetix https://www.youtube.com/watch?v=IpIf5DTz33s 

### 黑魔法展示
* Hacking a server with RealVNC CVE-2006-2369  https://www.youtube.com/watch?v=KWhsei-cATY
* 系上首頁？

### 讀書會讀本
* 網路概論與伺服器架設
http://linux.vbird.org/linux_server/
* 防火牆概論
http://www.phcno1.net/modules/tad_book3/html_all.php?tbsn=4 

### 延伸閱讀
* 防駭戰士 https://search.books.com.tw/redirect/move/key/%E9%98%B2%E9%A7%AD+%E6%AD%90%E8%90%8A%E7%A6%AE/area/mid/item/0010368023/page/1/idx/2/cat/001/pdf/1
* 防駭超級工具
https://search.books.com.tw/redirect/move/key/%E9%98%B2%E9%A7%AD+%E6%AD%90%E8%90%8A%E7%A6%AE/area/mid/item/0010394424/page/1/idx/1/cat/001/pdf/1

### 任務分配
* 介紹一下，Linux/Windows安裝完之後預設的基礎服務有哪些？
* 一台Windows裝好之後放在公開網路上到底安不安全？
* 我到底該不該做安全更新？
* 收集介紹一下 Java / Apache / PHP / Bash ShellShock 的弱點
https://www.cvedetails.com/google-search-results.php?q=GDI%2B&sa=Search
* 嘗試探測一下，海大DNS 140.121.80.16 的弱點
* 分享一下強化自己主機的經驗


## 12/6 了解你的戰場
### 講義
* 網路架構基礎
https://github.com/sakura26/DADA/blob/master/network_defense_intro.md
* 網路架構進階
https://github.com/sakura26/DADA/blob/master/network_defense_advance.md
* 無線網路安全
https://github.com/sakura26/DADA/blob/master/network_defense_wifi.md

### 黑魔法展示
* 宿網流量？
* NetCut https://www.youtube.com/watch?v=eSIkEBCto40
* cain and abel https://www.youtube.com/watch?v=7TFn6mNk1h8
* SSL strip https://avicoder.me/2016/02/22/SSLstrip-for-newbies/
* 網路竊聽器 被動式竊聽器
* Lan Turtle https://www.hak5.org/gear/lan-turtle 
* 惡搞你的鄰居 https://www.youtube.com/watch?v=csgrXFCtPqI
https://www.youtube.com/watch?v=-0ofQsAwF2I 
* Wifi組合技：鳳梨 https://shop.hak5.org/products/wifi-pineapple
https://www.youtube.com/watch?v=1FQtaGfvTvE

### 讀書會讀本
* CCNA網路概論
* 防火牆概論 http://www.phcno1.net/modules/tad_book3/html_all.php?tbsn=4 

### 進階閱讀
* Wireshark入門 https://www.cnblogs.com/52php/p/6262956.html 
* 上Wiki尋找ARP / HTTP / FTP / EMAIL等協定的說明

關於ARP Spoofing

* 有些朋友一開場就開始偽造封包卡關，我會建議先理解arp的結構與行為，觀察正常與不正常的封包，這樣會比較順暢
* 首先，用wireshark抓一下封包，搜尋ARP
* 然後跟wiki比對一下
  * https://zh.wikipedia.org/wiki/%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90%E5%8D%8F%E8%AE%AE
* 看懂它的結構與意義，然後試試用netcut打攻擊封包出去，繼續用wireshark觀察，看看他做了什麼，對方主機上的arp table被造成了哪些改變，網路行為發生了哪些改變
* 接著可以試著偽造封包了，有幾條路線
  * 用現成工具，cain and abel本身可以幫你完成ARP Spoofing, 但是除了竊聽外，你沒什麼可以做
  * 寫程式來打封包出去，我自己之前是用C, 有些朋友用python搭配scapy也成功了，這就各憑本事了。一旦你成功這麼做，你就真正掌握網路攻擊的基礎能力

### 任務分配
* 試著畫一下自己家裡/實驗室/任何你看得到的地方的網路結構圖？
* 如果正好，幫自己架設一個無線網路
* 試著用Wireshark “看懂” 你是怎麼連到Google看他的網頁的
* 分成兩組人馬，藍Team使用Telnet連去PTT發廢文，紅Team攻擊
  * 紅Team任務目標：拿到對方的帳號密碼，或成功擷取對方的發文內容
  * 藍Team任務目標：試著發現攻擊，試著找到攻擊者
* 分成兩組人馬，藍Team架設一個無線AP，紅Team攻擊
  * 紅Team任務目標：劫持藍Team瀏覽的海大資工首頁，把內容換掉
  * 藍Team任務目標：瀏覽 http://www.cs.ntou.edu.tw，直到發現被攻擊

推薦藍Team使用全新註冊的帳號，最好是一台不是自己的電腦來做這件事 - 不然紅Team可能會不小心錄到你很多私人的玩意

**記得，身為一個巫師，永遠不濫用魔法**

#### 實戰經驗分享 by @jasperlin1996

https://hackmd.io/AT85E4oYRQOgAwUmdgjEEg

#### 這次的挑戰分為幾個階段

* 使用ARP Spoofing欺騙受害者與Gateway
  * 如果成功的話，你會開始在你的電腦看到受害者的封包，但是永遠只會看到一部分 - 因為封包沒有走完全程，所以TCP需要三方交握會失敗
  * 受害者的網路雖然連著，但連接網頁之類的應用會失敗
  * 受害者觀察arp命令，會注意到自己的gateway mac已經被改寫了
  * 要留意的是，arp本身是一個自我學習的協議，如果有正常的封包通過了，他又會更新自己的arp table, 你的欺騙就失效了，所以打的時候請持續地打，頻率自己抓一下。
  * 基於上面，如果你被arp spoofing攻擊了，事實上封包錄一下馬上就看得出來了（笑
  * 也因此，事實上有一些防禦機制存在，例如交換器端可以鎖死mac位址，或主動偵測arp封包是否有爭奪或頻率過高的問題，用戶端有些防火牆也可以處理這件事
* 為了讓封包可以正常完成，所以我們也需要把受害者送來的封包轉送給Gateway（反之亦然），你可以使用linux內建的路由功能，或是自己收了封包轉發
  * 如果成功的話，受害者的網路會開始可以正常操作。雖然速度會有點慢（多繞一圈）也可能沒那麼穩（arp spoofing在搶）
  * 可以試試看 sysctl -w net.inet.ip.forwarding=1
  * 有沒有轉送成功，我會建議你在兩台電腦上都開wireshark之類的工具看封包來做確認
* ok, 現在數據流都經過你的電腦走了，你可以完整的竊聽對方的流量（也就是Ma at middle Attack, MitM）
* 下一步，如果你現在想要改寫對方前往 http://www.cs.ntou.edu.tw 的結果，首先我們得先認出這個封包
```
src mac: 受害者 dst mac: hacker
src ip: 受害者 dst ip: 140.121.196.158
TCP dst port: 80
```
* 而海大首頁回傳的封包長得像這樣
```
src mac: gateway dst mac: hacker
src ip: 140.121.196.158 dst ip: 受害者
TCP src port: 80
```
* 那，只要收到這個request, 就不要轉送，改成你自己偽裝成海大資工首頁回覆封包給對方就好啦 ☆
  * 如果轉送了也無所謂，搶先一步回覆就好了，晚到的封包會被丟掉
  * 為了做到這件事，我會建議你先充分的理解一個TCP連線的過程，尤其是三方交握的動作
  * 使用Wireshark好好的觀察你對HTTP的連線發生的事情會很有幫助
* 另一種劫持方式，你可以透過DNS poisoning來實作
  * https://en.wikipedia.org/wiki/DNS_spoofing
  * 由於從網域轉換到IP是靠DNS實現的，如果對方查詢DNS的時候就得到錯誤的IP位址（例如駭客的假網站），就等同換掉頁面了
  * 早期可以靠狂塞假的DNS Response封包給對方（因為使用UDP射後不理的關係），但現在發送與接收會比對序列號，所以你還是得比照上面的方式來給他假封包
  * 事實上還是有暴力亂塞的做法，連序列號都暴力噴給他...

然後，更偷懶一點，這邊有Cain & Abel的使用手冊，你可以使用ARP-DNS進行欺騙

https://drive.google.com/file/d/0B_HZnwwA-F-iYm1Rc1hKdGxIYlU/view

也有一些MITM的Proxy工具可用

https://mitmproxy.org/


### 關於密碼破解

密碼加鹽不夠味，還要加點胡椒ＸＤ

簡述一下密碼儲存的歷史
＊上古時代，大家密碼都直接寫死或存在資料庫裡，結果SQLInjection之類的攻擊可以讀取資料庫，大家密碼就一次噴光光，加上一堆人共用密碼，就各種歡樂
＊後來想到，好吧，那我就不要儲存明文密碼了，只存單向hash（MD5之類），每次用戶輸入就再Hash一次比對一不一樣，這樣就沒有原文密碼了，被偷了駭客也要自己暴力破解才知道原文，進入了石器時代
＊但進入帝國時代（顯示卡運算），駭客開始能使用高度平行運算＋網路串聯的網格運算大量破解，此時有人提出一個想法：Yes, Hash這種單向函數是單向的沒錯。但如果我把所有可能性都算出來存成一個資料庫，以後查表不就破解了？從此之後彩虹表（Rainbow Table）橫空出世<

例如我手上有一份MD5 14碼長的彩虹表，2T好像，我可以在數秒內查出14碼內的任何密碼原文

＊為了對抗這種程度的大規模運算的破解，所以網站導入了加鹽的新技術。每一個用戶密碼都包含一組隨機產生的亂數混合之後再做Hash，由於這個亂數是隨機的，彩虹表就開始不容易直接查了。假設Salt是6碼，用戶密碼是10碼，最終生成的密碼是16碼，彩虹表只有14碼，就查不到了

可以去翻一下Linux中的 /etc/shadow 這個檔案，這邊實際儲存著用戶密碼，他就有使用salt

看到他的密碼欄位會注意到，那一串不只是hash, 還有一堆標記記錄著，這是哪一種演算法，是否有加鹽等等資訊，有空可以研究看看 --拆拆看朋友主機上的密碼--
https://www.aychedee.com/2012/03/14/etc_shadow-password-hash-formats/

＊ok, 現在我們有不會那麼容易被帝國全盤破解的密碼庫了，但單一個人還是有可能被破解，尤其是現在運算資源那麼容易取得，暴力破解一兩個重要帳號還是很簡單，所以現在有人提出要加胡椒，胡椒存在app中，要同時取得資料庫與app權限才容易暴力破解

＊當然，帝國也沒那麼簡單，有死星等級的武器：Hash碰撞，直接破解演算法來改變整個戰場。例如MD5已經被視為沒有保護能力了

所以，大家應該注意到一件事
密碼長度「極、度、重、要」。你可以不用大小寫不用特殊符號，但請確保你的密碼夠長
如果在某個舊網站，他slat 6碼，你的密碼6碼，加起來md5 12碼，就算你密碼超複雜超難記，對我來說破解還是秒級的事情

但如果你密碼9碼，這樣總長度15碼，我就沒辦法用RainbowTable瞬解，只好慢慢暴力破，而越長的密碼暴力破解的時間也越長，直接大幅增強抗性

大概4這樣
https://plainpass.com/


## 1/3 後門概論

### 講義
[Google Chrome擴充套件後門解析](https://slides.com/sakura26/plugin-backdoor-analysis)

### 黑魔法展示


### 讀書會讀本


### 進階閱讀


### 任務分配


## 2/21 對抗大規模監控

### 講義
*   [給人權工作者的自保指南](https://slides.com/sakura26/general-information-security-defense-for-ngo) - 第一線的鬥士，身無寸甲卻要面對巨型企業與政府，這是你們該知道的....
*   [監控](https://github.com/sakura26/DADA/blob/master/monitoring.md) - 當一個人能隨時了解你的過去、現在的一切，甚至能操控你的未來...這是現在進行式
*   [反監控](https://github.com/sakura26/DADA/blob/master/anti-monitoring.md)  - 續上，身為一個普通人/駭客，我們怎麼對抗？
*   [反反監控](https://github.com/sakura26/DADA/blob/master/anti-anti-monitoring.md) - 再續上，身為網管，我該怎麼面對這些躲避措施？

### 讀書會讀本

電影

* 史諾登 揭發菱鏡事件的主角
* 攻殼機動隊 這部作品，正是我們的現在與未來。
* 楚門的世界 這部電影，真實的發生著在我們的身邊

[中國監控與翻牆史](http://www.cup.com.hk/2017/01/19/chester-ho-china-ramps-up-control-of-domain-names/)

[道高一尺，牆高一丈：互聯網封鎖是如何升級的](https://theinitium.com/article/20150904-mainland-greatfirewall/)

[釣魚網站識別](https://www.informationsecurity.com.tw/article/article_detail.aspx?aid=6813)

[釣魚網站/郵件識別](https://safety.yahoo.com/HK/Security/PHISHING-WEBSITE-HK.html)

[有半數釣魚網站都會讓你以為它是安全的](https://chinese.engadget.com/2018/11/27/half-of-phishing-sites-now-show-as-secure/)

[自我審查](https://zh.m.wikipedia.org/zh-hant/%E8%87%AA%E6%88%91%E5%AF%A9%E6%9F%A5)

[稜鏡計畫](https://zh.wikipedia.org/wiki/%E7%A8%9C%E9%8F%A1%E8%A8%88%E7%95%AB)

[Lightbeam For Firefox- Tracking Your Personal Information Online](https://www.youtube.com/watch?v=2aesvIjQyAo)

[粉碎稜鏡計劃](https://prism-break.org/)

### 進階閱讀

[DNS Spoofing](https://ithelp.ithome.com.tw/articles/10193791)

[MiTM](https://zh.wikipedia.org/zh-tw/%E4%B8%AD%E9%97%B4%E4%BA%BA%E6%94%BB%E5%87%BB)

[TCP RST Attack](https://medium.com/@wenchenx/%E8%AE%80%E6%9B%B8%E7%AD%86%E8%A8%98-tcp-reset%E5%B0%81%E5%8C%85%E7%9A%84%E7%B6%B2%E8%B7%AF%E6%94%BB%E6%93%8A-a35b5955b12b)

[V2Ray](https://toutyrater.github.io/)

[ShadowSocks SSR](https://congcong0806.github.io/2018/04/20/SS/)

[SSH Tunnel/DNS Tunnel](https://github.com/sakura26/DADA/blob/master/anti-monitoring.md#ssh-tunnel)

### 任務分配

## 3/7 我要開公司！用 Hacking 的角度把興趣變事業

## 3/21 雲端應用：Serverless 初體驗 - 使用Cloud Functions

<https://docs.google.com/presentation/d/1rF86xmVvPSSUsDfDYaNzaGbu3DrOg7phBUp72Jq46zQ>

## 3/28 主機鑑識

<https://github.com/sakura26/DADA/blob/master/forensic_windows.md>

## 4/25 Log分析入門、架構、與戰情分析

### 講義
* [Log分析入門](https://github.com/sakura26/DADA/blob/master/log_analysis_intro.md)
* [Log分析架構篇](https://github.com/sakura26/DADA/blob/master/log_analysis_arch.md)
* [Log分析進階](https://github.com/sakura26/DADA/blob/master/log_analysis_adv.md)
* [Log分析 by Ivan](https://github.com/sakura26/DADA/blob/master/log_analysis_ivan.pdf)

### 黑魔法展示

* innocence 1:17:24
* GIS GIG 09 1:29, 6:33, 11:18, 21:25
* [Security operation center](https://www.google.com/search?biw=1600&bih=668&tbm=isch&sa=1&ei=AT7BXObIEe-Gr7wPtNabkAE&q=security+operation+center&oq=security+operation+center&gs_l=img.3..0j0i30l9.31981.39454..39799...0.0..0.54.1132.25......1....1..gws-wiz-img.YOaqAkzb8AU)
* [AcerEdc SOC](https://youtu.be/L3T1alGZtHs?t=22)
* [Log刷你臉](https://www.youtube.com/watch?v=XvyrUfuLGVk)
* [Logstalgia](https://youtu.be/jqlIQ0MXsnA?t=184)

### 環境準備
如果你是Linux環境，我想你應該檔案解壓縮之後馬上就可以照著講義上的命令開始動手了。   
如果你是Windows環境，[Win10的話可以使用內建的Bash shell](http://hvsimon-lin.logdown.com/posts/776788-windows-linux-bash-shell-can-also-be-performed-built-in-linux-subsystems)處理。如果不是Win10, 請安裝Cygwin, 或是找一台Linux來用（推薦裝台虛擬機）

### 作業

[某台被入侵的主機 Apache 2 Log](https://github.com/sakura26/DADA/blob/master/sample-apache2.log.gz?raw=true)

主機敏感資料已經被取代過了

試回答以下問題：

基礎
* 最熱門的網頁是哪一頁？
* 最多人是從什麼網站轉來的呢？
* 來的訪客IP瀏覽量最多頁面前十名
* 畫出總來訪次數折線圖（以小時為單位）
* 來得不全部都是"人"，算算有多少機器人你認得出來的？他們佔了整體次數多少呢？

進階
* 訪客"傳輸資料量"最大的前十名
* 試著找到管理頁面的入口 
* 有沒有什麼疑似的攻擊行為呢？
* 有一個駭客做了滿高調的攻擊行為，找到他的IP，並回答他有沒有成功

加分題 如果你有本事從這份Log找出這台主機是誰，請私底下跟我說ＸＤ


## 5/2 雲端應用：用 Docker CE 玩容器

<https://docs.google.com/presentation/d/1KgFxhPGhCUZcegNa2LGRUNr9XnY3FZ2zWM5F4oBXWgw>

## 5/23 黑產、APT

### 講義

### 黑魔法展示

### 讀書會讀本

### 進階閱讀

### 任務分配

## 5/30 Hack your life - 駭客的人生指南 、實體安全

### 講義

### 黑魔法展示

### 讀書會讀本

### 進階閱讀

### 任務分配

## 6/6 Snap打包

### 講義

### 展示

### 讀書會讀本

### 進階閱讀

### 任務分配